<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How to get loans funded on kiva | Matt Lichti’s Data Science Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="How to get loans funded on kiva" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Random Forest Model to Predict Kiva Loan Funding." />
<meta property="og:description" content="Random Forest Model to Predict Kiva Loan Funding." />
<link rel="canonical" href="https://mattlichti.github.io/blog/markdown/2015/06/01/kiva-funding-model.html" />
<meta property="og:url" content="https://mattlichti.github.io/blog/markdown/2015/06/01/kiva-funding-model.html" />
<meta property="og:site_name" content="Matt Lichti’s Data Science Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-06-01T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://mattlichti.github.io/blog/markdown/2015/06/01/kiva-funding-model.html","@type":"BlogPosting","headline":"How to get loans funded on kiva","dateModified":"2015-06-01T00:00:00-05:00","datePublished":"2015-06-01T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mattlichti.github.io/blog/markdown/2015/06/01/kiva-funding-model.html"},"description":"Random Forest Model to Predict Kiva Loan Funding.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://mattlichti.github.io/blog/feed.xml" title="Matt Lichti's Data Science Blog" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Matt Lichti&#39;s Data Science Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How to get loans funded on kiva</h1><p class="page-description">Random Forest Model to Predict Kiva Loan Funding.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2015-06-01T00:00:00-05:00" itemprop="datePublished">
        Jun 1, 2015
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#markdown">markdown</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#motivation">Motivation</a></li>
<li class="toc-entry toc-h2"><a href="#data">Data</a>
<ul>
<li class="toc-entry toc-h3"><a href="#pipeline">Pipeline</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#feature-engineering">Feature Engineering</a>
<ul>
<li class="toc-entry toc-h3"><a href="#continuous-features">Continuous features</a></li>
<li class="toc-entry toc-h3"><a href="#categorical-features">Categorical features</a></li>
<li class="toc-entry toc-h3"><a href="#transforming-the-text-into-features">Transforming the text into features</a></li>
<li class="toc-entry toc-h3"><a href="#competing-loans">Competing loans</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#modeling">Modeling</a>
<ul>
<li class="toc-entry toc-h3"><a href="#weighted-random-forest">Weighted Random Forest</a></li>
<li class="toc-entry toc-h3"><a href="#model-tuning">Model Tuning</a></li>
<li class="toc-entry toc-h3"><a href="#out-of-sample-error">Out of Sample Error</a></li>
<li class="toc-entry toc-h3"><a href="#running-the-model">Running the model</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#plotting">Plotting</a></li>
<li class="toc-entry toc-h2"><a href="#results">Results</a></li>
</ul><p>I built a predictive model to analyze which features make microfinance loans on <a href="kiva.org">kiva.org</a> more likely to get funded. This post was originally written in 2015 and was reformatted for my fastpages blog in 2021. All of the code is available on <a href="https://github.com/mattlichti/kiva-fundraising-success">github</a></p>

<p><img src="https://github.com/mattlichti/kiva-fundraising-success/blob/master/img/title.jpg?raw=true" alt="Title Slide"></p>

<h2 id="motivation">
<a class="anchor" href="#motivation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Motivation</h2>

<p>There are over 2 million small time lenders on kiva who have funded over 880,000 microfinance loans totaling $712 million since 2005. The loans are originally made by 296 different microfinance organizations in 85 countries who use kiva to raise money to backfill some of their loans. Lenders can view the loans on the website and lend as little as $25 to any of the borrowers they chose.</p>

<p>Since January 2012, kiva has usually had a 30 day expiration policy. If a loan is not fully funded in that time, the lenders are refunded and the microfinance organization does not receive any money. This is similar to the funding model used on kickstarter where projects do not receive any money unless they are fully funded. Because of the risk of loan expiration, it is important for the microfinance organizations to understand the characteristics that make loans more likely to get funded. The analysis could also help kiva.org increase the total number of loans getting funded, which would help more struggling entrepreneurs around the globe get the capital they need to build their businesses</p>

<h2 id="data">
<a class="anchor" href="#data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data</h2>

<p>Kiva makes their loan data available through their api. They also periodically make downloadable snapshots of the data. I most recently used the May 18 2015 json snapshot for this analysis. The loan data is in a 1 GB zip file that is 5 GB when unzipped.</p>

<h3 id="pipeline">
<a class="anchor" href="#pipeline" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pipeline</h3>

<p><a href="https://github.com/mattlichti/kiva-fundraising-success/blob/master/data_pipeline.py">data_pipeline.py</a> is used for processing the raw kiva loan data. It extracts the relevant data, performs the feature engineering, and then stores it all in a postgres SQL database. To run the pipeline, unzip the loans folder containing around 1800 json files that each have the data from 500 loans. Then setup a postgres database and run pipeline.py in the terminal the loans folder location and sql information as command line arguments. The most important part of the process is feature engineering. The features include anything that a potential borrower sees when viewing a loan on kiva org that they can use to decide whether or not to loan to a particular individual.</p>

<h2 id="feature-engineering">
<a class="anchor" href="#feature-engineering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Feature Engineering</h2>

<p>The most important part of the process is feature engineering. The features include anything that a potential borrower sees when viewing a loan on kiva org that they can use to decide whether or not to loan to a particular individual. A typical view of a loan from the kiva website is pictured below with some of the important features highlighted.</p>

<p><img src="https://github.com/mattlichti/kiva-fundraising-success/blob/master/img/feature_engineering.jpg?raw=true" alt="Feature Engineering"></p>

<h3 id="continuous-features">
<a class="anchor" href="#continuous-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Continuous features</h3>
<ul>
  <li>loan amount</li>
  <li>repayment term (anywhere from 4 months to several years)</li>
  <li>group size (loans can be for 1 person or a group of people)</li>
</ul>

<h3 id="categorical-features">
<a class="anchor" href="#categorical-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Categorical features</h3>
<ul>
  <li>gender</li>
  <li>country - currently 84 countries</li>
  <li>sector - 15 categories like transportation or agriculture</li>
  <li>activity - 150 categories like “rickshaw” or “cattle”</li>
  <li>repayment interval - loans payments can be monthly, lump sum at the end, or irregular</li>
  <li>themes - searchable attributes like “green”, “fair trade”, “conflict zones”, etc.</li>
  <li>currency loss - whether the lender is liable for losses due to currency fluctuations</li>
  <li>anonymous - whether the borrower has their name and photo on the website or chooses to remain anonymous.</li>
</ul>

<h3 id="transforming-the-text-into-features">
<a class="anchor" href="#transforming-the-text-into-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Transforming the text into features</h3>
<p>I used the one sentence description of how the loan will be used to engineer features out of the most commonly used terms. The length of this text as well as the length of the larger description text were also useful features.</p>

<h3 id="competing-loans">
<a class="anchor" href="#competing-loans" aria-hidden="true"><span class="octicon octicon-link"></span></a>Competing loans</h3>
<p>In addition to the features that impact demand for particular loans, the supply of loans on the site can effect the chances of each loan getting funded. I used SQL to calculate the number of other loans on kiva at the time each loan was posted by comparing the timestamp of when each loan was posted to the timestamps for when other loans were posted and funded or expired.</p>

<p><img src="https://github.com/mattlichti/kiva-fundraising-success/blob/master/plots/competing_loans.png?raw=true" alt="Competing Loans"></p>

<p>When there are few loans on the site, almost all of the loans get funded. When there is more competition, lenders have more options each loan has a higher chance of expiring. In the future, it might be useful to look at the total value of the loans currently fundraising and how far along they are in their fundraising, not just the number of loans. It might also be useful to look at attributes of those loans. For example, if there are a lot of loans currently fundraising from the same country or economic sector as the loan being posted, it may lower the chance of that loan getting funded.</p>

<h2 id="modeling">
<a class="anchor" href="#modeling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modeling</h2>
<p><a href="https://github.com/mattlichti/kiva-fundraising-success/blob/master/build_model.py">build_model.py</a> is used to train the model, predict which loans have a higher risk of expiring, and determine which features are most important in predicting loan success. The model converts the categorical features into boolean dummy variables, and tokenizes, lemmatizes, and performs TF-IDF on the text. I used a random forest model. The classes were unbalanced with a much higher number of funded loans than expired loans, so I heavily weighted the expired loans in order to increase recall of expired loans at the expense of precision. The model can output a confusion matrix and a list of feature importance which could be used as recommendations on how to improve their odds of getting their loans funded.</p>

<h3 id="weighted-random-forest">
<a class="anchor" href="#weighted-random-forest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Weighted Random Forest</h3>

<p>I used a random forest model. The classes were unbalanced with a much higher number of funded loans than expired loans, so I heavily weighted the expired loans in order to increase recall of expired loans at the expense of precision. I also tried logistic regression and SVM but they have not performed quite as well.</p>

<h3 id="model-tuning">
<a class="anchor" href="#model-tuning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model Tuning</h3>

<p>I had to tune the model quite a bit to avoid overfitting. I used a grid search to determine optimal values for the weight of the unbalanced class, minimum number of samples to split each node, and the minimum number of samples on each newly created leaf. I used cross validation to determine which set of parameter values had the best combination of recall and precision on the test sets.</p>

<h3 id="out-of-sample-error">
<a class="anchor" href="#out-of-sample-error" aria-hidden="true"><span class="octicon octicon-link"></span></a>Out of Sample Error</h3>

<p>The model will still be somewhat biased since the test sets were from the same time period as the training sets and may net work as well data from a future time period. Because of this, I also tried training the model on one time period (May - November 2014) and testing it on a later time period (January - March 2015). The one month gap is necessary because someone predicting current loans would not know which loans posted in the last month will expire since they have 30 days to get funded. The model does not perform as well with different time periods which shows there are time related variables that aren’t captured by the model.</p>

<h3 id="running-the-model">
<a class="anchor" href="#running-the-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the model</h3>
<p><a href="https://github.com/mattlichti/kiva-fundraising-success/blob/master/run_model.py">run_model.py</a> is used to load the relevant data from the postgres sql database and run the model on that data. It can be run from the command line like data_pipeline.py.</p>

<h2 id="plotting">
<a class="anchor" href="#plotting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plotting</h2>
<p><a href="https://github.com/mattlichti/kiva-fundraising-success/blob/master/plots.py">plots.py</a> is used to make plots of the feature importance of the most important features in the random forest model, as well as plot the expiration rate based on a variety of features and the expiration rate over time.</p>

<h2 id="results">
<a class="anchor" href="#results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Results</h2>
<p><img src="https://github.com/mattlichti/kiva-fundraising-success/blob/master/plots/feature_importance.png?raw=true" alt="Feature Importance">
Lenders on kiva show a strong preference for loans with a shorter repayment term as well as loans to women. Loans for larger amounts of money are not surprisingly more difficult to fund since they require more lenders to fully fund. Lenders also prefer lending to certain countries, especially African countries and countries with fewer loans available on kiva. Loans to countries with lots of loans available like El Salvador (SV) and Colombia (CO) are at greater risk for loan expiration. Lenders also have strong preferences for different loan uses with loans for personal housing much more likely to expire than loans for education or starting a business.</p>

  </div><a class="u-url" href="/blog/markdown/2015/06/01/kiva-funding-model.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Blog about deep learning with Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/mattlichti" title="mattlichti"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/mattlichti" title="mattlichti"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
